name: Build SINUX APK
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    steps:
    # 1. CHECKOUT
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
    
    # 2. SETUP PYTHON (SIMPLIFIED - NO CACHE)
    - name: ğŸ Setup Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        # REMOVED: cache: 'pip' - No requirements.txt needed
    
    # 3. INSTALL DEPENDENCIES
    - name: âš™ï¸ Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          python3-pip \
          python3-dev \
          openjdk-11-jdk \
          zip \
          unzip \
          git
        
    # 4. INSTALL BUILDOZER
    - name: ğŸ“¦ Install Buildozer
      run: |
        pip3 install --upgrade pip
        pip3 install buildozer
        pip3 install cython==0.29.33
    
    # 5. CREATE BUILDOZER.SPEC
    - name: âš™ï¸ Create Config
      run: |
        echo '[app]' > buildozer.spec
        echo 'title = SINUX OS' >> buildozer.spec
        echo 'package.name = sinux' >> buildozer.spec
        echo 'package.domain = org.test' >> buildozer.spec
        echo 'source.dir = .' >> buildozer.spec
        echo 'version = 1.0' >> buildozer.spec
        echo 'requirements = python3' >> buildozer.spec
        echo 'orientation = portrait' >> buildozer.spec
        echo 'android.permissions = INTERNET' >> buildozer.spec
    
    # 6. BUILD APK
    - name: ğŸ—ï¸ Build APK
      run: |
        echo "Starting build..."
        buildozer android debug
      timeout-minutes: 45
    
    # 7. UPLOAD APK
    - name: ğŸ“¤ Upload APK
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: sinux-apk
        path: bin/*.apk
